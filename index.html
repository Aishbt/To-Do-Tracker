<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Mission</title>
<!-- PWA basics -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Daily Mission">
<meta name="theme-color" content="#e0c3fc">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #8ec5fc, #e0c3fc);
  color: #2f2f2f;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 4px;
}

.date {
  text-align: center;
  opacity: 0.7;
  margin-bottom: 20px;
}

.card {
  background: rgba(255,255,255,0.65);
  border-radius: 18px;
  padding: 16px;
  margin-bottom: 16px;
}

input[type="text"] {
  width: 70%;
  padding: 10px;
  border-radius: 12px;
  border: none;
}

button {
  padding: 10px 14px;
  border-radius: 12px;
  border: none;
  background: #7c9cff;
  color: white;
  font-weight: bold;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

li input {
  margin-right: 10px;
  transform: scale(1.3);
}

.progress {
  height: 10px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: #7c9cff;
  transition: width 0.3s;
}

.reward {
  text-align: center;
}

.reward img {
  width: 100%;
  border-radius: 14px;
  margin-top: 10px;
}

.locked {
  opacity: 0.6;
}

.lost {
  color: #c05656;
}

.won {
  color: #3a7f5d;
}
</style>
</head>

<body>

<h1>üå∏ Daily Mission</h1>
<div class="date" id="today"></div>

<div class="card">
  <input type="text" id="taskInput" placeholder="Add today‚Äôs task‚Ä¶" />
  <button onclick="addTask()">Add</button>
</div>

<div class="card">
  <ul id="taskList"></ul>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
</div>

<div class="card reward" id="rewardBox">
  üîí A gentle visitor may arrive tomorrow.
</div>

<script>
const today = new Date().toDateString();
const yesterday = new Date(Date.now() - 86400000).toDateString();

document.getElementById("today").innerText = today;

const characters = [
  {
    name: "Forest Spirit",
    img: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee"
  },
  {
    name: "Gentle Child",
    img: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e"
  },
  {
    name: "Tiny Creature",
    img: "https://images.unsplash.com/photo-1519681393784-d120267933ba"
  },
  {
    name: "Soft Animal",
    img: "https://images.unsplash.com/photo-1507149833265-60c372daea22"
  }
];

let data = JSON.parse(localStorage.getItem("missionData")) || {};

if (!data[today]) {
  data[today] = { tasks: [], completed: false };
}

function addTask() {
  const input = document.getElementById("taskInput");
  if (!input.value) return;
  data[today].tasks.push({ text: input.value, done: false });
  input.value = "";
  save();
  render();
}

function toggleTask(i) {
  data[today].tasks[i].done = !data[today].tasks[i].done;
  save();
  render();
}

function render() {
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  const tasks = data[today].tasks;
  let done = 0;

  tasks.forEach((t, i) => {
    if (t.done) done++;
    const li = document.createElement("li");
    li.innerHTML = `
      <input type="checkbox" ${t.done ? "checked" : ""} onclick="toggleTask(${i})">
      ${t.text}
    `;
    list.appendChild(li);
  });

  const percent = tasks.length ? (done / tasks.length) * 100 : 0;
  document.getElementById("progressBar").style.width = percent + "%";

  data[today].completed = tasks.length > 0 && done === tasks.length;
  save();
  updateReward();
}

function updateReward() {
  const box = document.getElementById("rewardBox");

  if (data[yesterday] && data[yesterday].completed && !data[yesterday].reward) {
    const chosen = characters[Math.floor(Math.random() * characters.length)];
    data[yesterday].reward = chosen;
    save();
  }

  if (data[yesterday]?.reward) {
    box.className = "card reward won";
    box.innerHTML = `
      üå± She arrived because you kept your promise.<br>
      <img src="${data[yesterday].reward.img}">
    `;
  } else if (data[yesterday] && !data[yesterday].completed) {
    box.className = "card reward lost";
    box.innerHTML = "‚ùÑÔ∏è This visitor never arrived.";
  } else {
    box.className = "card reward locked";
    box.innerHTML = "üîí A gentle visitor may arrive tomorrow.";
  }
}

function save() {
  localStorage.setItem("missionData", JSON.stringify(data));
}

render();
</script>

</body>
</html>
